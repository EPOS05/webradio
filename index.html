<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streaming Site</title>
</head>
<body>
    <!-- Hidden audio element for playback -->
    <audio id="audioPlayer" style="display: block;" controls></audio>

    <script>
        // Function to parse query parameters from URL
        function getQueryParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Function to fetch MP3 files JSON
        async function fetchMP3FilesJSON(jsonFileUrl) {
            try {
                const response = await fetch(jsonFileUrl);
                if (response.ok) {
                    const json = await response.json();
                    const mp3Files = json.mp3_files;
                    if (mp3Files.length > 0) {
                        // Start playing audio
                        playAudio(mp3Files);
                    } else {
                        console.log('No MP3 files available in JSON.');
                    }
                } else {
                    console.error("Fetch Error:", response.statusText);
                }
            } catch (error) {
                console.error('Error fetching MP3 files JSON:', error);
            }
        }

        // Function to play audio continuously like a live radio stream
        function playAudio(mp3Files) {
            const audioPlayer = document.getElementById('audioPlayer');
            let currentIndex = 0;

            // Function to play the next audio file
            function playNext() {
                // Set source of audio player to the current file
                audioPlayer.src = mp3Files[currentIndex];
                console.log("Loading:", audioPlayer.src);

                // Autoplay audio
                audioPlayer.autoplay = true;

                // Play audio
                audioPlayer.play()
                    .then(() => {
                        console.log("Playing:", mp3Files[currentIndex]);
                    })
                    .catch(error => console.error("Error playing:", mp3Files[currentIndex], error));
            }

            // Play the first audio file
            playNext();

            // When an audio file ends, play the next one
            audioPlayer.onended = () => {
                // Move to the next audio file
                currentIndex = (currentIndex + 1) % mp3Files.length;
                // Play the next audio file
                playNext();
            };
        }

        // Fetch MP3 files JSON or play MP3 from URL when the page loads
        const jsonFileUrl = getQueryParameter('json');
        const mp3Url = getQueryParameter('mp3');
        if (mp3Url) {
            // Start playing audio from MP3 URL
            playAudio([mp3Url]);
        } else if (jsonFileUrl) {
            // Fetch MP3 files from JSON URL and start playing
            fetchMP3FilesJSON(jsonFileUrl);
        } else {
            console.error('MP3 URL or JSON file URL not provided.');
        }
    </script>
</body>
</html>
